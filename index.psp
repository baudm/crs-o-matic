<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>CRS-o-matic (using Python <%= ".".join(map(str, sys.version_info[:3])) %>)</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="main.css" />
  </head>
  <body>
    <div id="wrap">
      <div id="content">
        <strong>CRS-o-matic</strong> - a CRS schedule generator and probability and statistics tool written in pure Python<br/>
        <br/>
        This project is hosted at <a href="http://code.google.com/p/crs-o-matic/">Google Code</a>. For bug reports, feature requests, patch submissions, and the like, submit a new issue <a href="http://code.google.com/p/crs-o-matic/issues/list">here</a>.<br/>
        <br/>

        <strong>Clarification of Terms:</strong>
        <ul>
          <li>probability - the chances of getting a particular subject; probability = 100% means a 'sure shot'.</li>
          <li>mean - the mean of the probabilities of the subjects in a particular schedule.</li>
          <li>standard deviation - the standard deviation of the probabilities of the subjects in a particular schedule.</li>
        </ul>

        <strong>NOTES:</strong>
        <ul>
          <li>You would want a schedule with a high probability mean and a low standard deviation.</li>
          <li>The code is currently not _that_ clean and optimized and may eat a lot of resources. A <a href="http://probstat.sourceforge.net/">Python extension module (written in C)</a> is used to speed up the <a href="http://en.wikipedia.org/wiki/Cartesian_product">Cartesian product</a> calculations.</li>
          <li>Duplicate schedules (think of Math 17, 53, etc.) might be displayed. I'm still working on it.</li>
        </ul>

        <strong>TODO:</strong>
        <ul>
          <li>More optimizations</li>
        </ul>

        <strong>Disclaimer:</strong>
        <p>All data presented by CRS-o-matic ('The Software') are just parsed from the <a href="http://crs2.upd.edu.ph/schedule">CRS website</a> and are not modified in any way. As such, I will not be responsible for any misleading or erroneous information produced by the software due to errors in the CRS website. I will also not be responsible for any misleading or erroneous information caused by bugs in the software. If you want to know how the software works, feel free to <a href="http://code.google.com/p/crs-o-matic/source/checkout">checkout</a> the source code via Subversion (SVN).</p>
<%
from math import sqrt

import crs
from htmltable import HTMLTable


if form.has_key('searchkey') and form['searchkey']:
    search = [s for s in form['searchkey'].split('\r\n') if s]
    # Sort search queries to have the same output each and every time (for the same input).
    search.sort()
    classes = []
    total_units = 0
%>
<%= '<br />Desired classes:\n<ul>' %>
<%
    for s in search:
        c = crs.search(s)
        if c:
            classes.append(c)
            if not c[0].name.startswith('CWTS') and not c[0].name.startswith('PE '):
                total_units += c[0].credits
%>
<%= '<li>%s (%d.0)</li>' % (c[0].name, c[0].credits) %>
<%
            else:
%>
<%= '<li>%s <em>(%d.0)</em></li>' % (c[0].name, c[0].credits) %>
<%
        else:
%>
<%= '<li><del>%s</del> <em>(no such class)</em></li>' % (s, ) %>
<%
    scheds = crs.get_schedules(*classes)
    p = 1
    for a in [len(a) for a in classes]: p *= a
%>
<%= "</ul>\nTotal number of units: <strong>%d.0</strong><br /><br />\nThere %s %d schedule%s without conflicts out of %d possible schedule%s:<br/>\n<br/>\n" % (total_units, 'is' if len(scheds) == 1 else 'are', len(scheds), '' if len(scheds) == 1 else 's', p, '' if p == 1 else 's') %>
<%
    s_ctr = 0
    for s in scheds:
        s_ctr += 1
        table = HTMLTable(len(s), 2, {'class': 'schedule', 'cellpadding': 0, 'cellspacing': 0})
        ctr = 0
        table.set_cell_attrs(0, 1, {'class': 'probability'})
        for header in ('Course', 'Prob.'):
            table.set_cell_type(0, ctr, 'th')
            table.set_cell_data(0, ctr, header)
            ctr += 1

        ctr = 1
        prob_list = []
        for c in s:
            try:
                prob_class = float(c.stats[0])/c.stats[1]
            except ZeroDivisionError:
                prob_class = 1.0

            if prob_class > 1.0:
                prob_class = 1.0

            prob_list.append(prob_class)

            table.set_cell_data(ctr, 0, " ".join([c.name, c.section]))
            table.set_cell_data(ctr, 1, "%.2f%%" % (100 * prob_class, ))
            ctr += 1

        prob = sum(prob_list)/len(classes)
        stdev = sqrt(sum(map(lambda x: (x-prob)*(x-prob), prob_list))/len(classes))

        table.set_cell_data(ctr, 0, 'Mean')
        table.set_cell_data(ctr, 1, "%.2f%%" % (100 * prob, ))
        table.set_cell_data(ctr + 1, 0, 'Std. Dev.')
        table.set_cell_data(ctr + 1, 1, "%.2f%%" % (100 * stdev, ))
        for i in range(ctr, ctr + 2):
            table.set_cell_attrs(i, 0, {'class': 'highlight'})
            table.set_cell_attrs(i, 1, {'class': 'highlight'})

        # begin HTML
%>
        <h2><%= s_ctr %></h2>
        <table class="parent-table">
            <tr>
                <td class="first">
<%= s.table() %>
                </td>
                <td>
<%= table.return_html() %>
                </td>
            </tr>
        </table>
        <br />
<%
else:
    sem = crs.get_semester()
%>
        <form id="form" method="post" action="">
          <fieldset>
            Semester: <strong><%= sem %></strong>
            <br/>
            <label for="searchkey">Desired subjects (newline-separated):</label><br/>
            <textarea id="searchkey" name="searchkey" rows="10" cols="20"></textarea><br/>
            <input type="submit" value="Submit" />
          </fieldset>
        </form>
<%
# end HTML
%>
        <p class="icon">
          <a href="http://validator.w3.org/check?uri=referer">
            <img src="http://www.w3.org/Icons/valid-xhtml10-blue" alt="Valid XHTML 1.0 Strict" height="31" width="88" />
          </a>
          <a href="http://jigsaw.w3.org/css-validator/check/referer">
            <img style="border:0;width:88px;height:31px" src="http://jigsaw.w3.org/css-validator/images/vcss-blue" alt="Valid CSS!" />
          </a>
        </p>
        <p class="copyright">
		Copyright &copy; 2008 <a href="http://www.darwin.uk.to/" title="Darwin M. Bautista">Darwin M. Bautista</a>
		</p>
      </div>
    </div>
  </body>
</html>
